<!doctype html>
<html lang="sv-se">

<head>
    <meta charset="utf-8">

    <title>Lecture - DOM and Events</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="icon" href="../images/favicon.png" type="image/png" />

    <link rel="stylesheet" href="../reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../reveal.js/css/theme/black.css" id="theme">
    <link rel="stylesheet" href="../reveal.js/css/theme/black.lnu.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="../reveal.js/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

</head>

<body>

    <div class="reveal lnu">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <!-- Start -->
            <section class="center" data-state="lnu-intro">
                <h3>Client-based Web Programming</h3>
                <h1>DOM and Events</h1>
                <div class="lnu-footer">
                    <img src="../images/lnu-logotype.png" />
                    <img src="../images/lnu-symbol.png" />
                </div>
            </section>

            <!-- CC -->
            <section data-state="lnu-cc">
                <h2>Licence for this work</h2>
                <p>
                    This work is produced by Johan Leitet for the course Client-based Web Programming (1DV022) at Linnaeus University.
                </p>
                <p>All content in this work excluding photographs, icons, picture of course litterature and Linnaeus University logotype and symbol, is licensied under a
                <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br />Creative Commons Attribution 4.0 International License</a>.</p>
                <h4>You are free to </h4>
                <ul>
                    <li>copy and redistribute the material in any medium or format</li>
                    <li>spread the whole or parts of the content</li>
                    <li>show the whole or parts of the content publicly and digital</li>
                    <li>convert the content to another format</li>
                    <li>change the content</li>
                </ul>
                <p>
                    If you change the content do not use the photographs, icons, picture of the course literature or Linnaeus University logotype and symbol in your new work!
                </p>
                <p>
                    At all times you must give credit to: ”Linnaeus university – Client-based Web Programming (1DV022)” with the link https://coursepress.lnu.se/kurs/klientbaserad-webbprogrammering/ and to the Creative Common-license above.
                </p>
            </section>

            <!-- Content -->
            <section data-markdown>
                <script type="text/template">
                ## Content

                * DOM
                  * Traversing
                  * Selecting
                  * Manipulating
                  * Templates
                * Event
                  * How not to - How to
                  * Event delegation
                  * Timers
                  * Event loop
                </script>
                <pre><code></code></pre> <!-- Fix for color coding in md -->
            </section>

        <!-- DOM -->
        <section>
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## The DOM

                Document object model
                ![](https://docs.google.com/drawings/d/1Oz05zW7ZsDlNeKFBgjIXnq41G773_pNXB_kd6nodRTM/pub?w=503&h=625) <!-- .element style="float:left" -->

                ```
                <html>
                  <head>
                    <title>Incident report</title>
                  </head>
                  <body>
                    <h1>Incident report</h1>
                    <p><a href="#">Last report</a></p>
                    <p><img src="photo" alt="" /></p>
                  </body>
                </html>
                ```

                The javascript engines API against the rendering engine.
                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Nodetypes

                |         | Name           | Value  |
                | :-------------: |:-------------:| :-----:|
                | <span style="border: 6px solid yellow; padding: 0 50px; border-radius:10px">H1</span>      | ELEMENT_NODE | 1 |
                | <span style="border: 6px solid blue; padding: 0 50px; border-radius:10px">#text</span> | TEXT_NODE     |   3 |
                | <span style="border: 6px solid green; padding: 0 50px; border-radius:10px">#comment</span> | COMMENT_NODE    |   8 |
                | <span style="border: 6px solid purple; padding: 0 50px; border-radius:10px">#document</span> | DOCUMENT_NODE    |   9 |
                | ... | ...    |   ... |

                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## \n

                 <img style="float:left;r" src="https://docs.google.com/drawings/d/1kbstEL_9IanG_JPJYSyjp1OxSbrw_1Xq5lTekyZhrxc/pub?w=739&h=623" />

                ```html
                <html>\n
                \t<head>\n
                \t\t<title>Incident report</title>\n
                \t</head>\n
                \t<body>\n
                \t\t<h1>Incident report</h1>\n
                \t\t<p><a href="#">Last report</a></p>\n
                \t\t<p><img src="photo" alt="" /></p>\n
                \t</body>\n
                </html>\n
                ```
                </script>
            </section>



             <!-- Traversing and selecting the DOM-->
	        <section class="noborderimages" data-markdown>
	            <script type="text/template">
                ## Traversing the DOM

                ![](https://docs.google.com/drawings/d/1SY36jZN7GqR7d2GQigKkE-W9HQcHpop9JHNBqf9s0DA/pub?w=1232&h=606)
	            </script>
	        </section>


	        <section class="noborderimages" data-markdown>
	            <script type="text/template">
                    ##Selecting nodes

                    |         | Parameter (ex)        | Returns  |
                    | :-------------: |:-------------:| :-----:|
                    | getElementById      | id    |  Node-element|
                    | getElementsByTagName| tag      |   Node-list|
                    | getElementsByClassName| class  |   Node-list|



                    ```javascript
                    let mainDiv = document.getElementById('main');

                    let pTags = document.getElementByTagName('p');
                    console.log(pTags.length);

                    let tags = document.getElementByClassName('post');
                    console.log(tags.length);
                    ```

	            </script>
	        </section>

	        <section id="selectorsAPI" class="noborderimages" data-markdown>
                <script type="text/template">
                ##Selectors API
                - One API to rule them all


                | | Returns       |
                |:----------------- |:-------------:|
                | querySelector     |  Node-element |
                | querySelectorAll  |   Node-list   |


                ```
                let mainDiv = document.querySelector('#main');

                let pTags = document.querySelectorAll('p');

                let tags = document.querySelectorAll('p.tag');
                ```

	            </script>
	        </section>

	        <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## NodeList
                NodeList.prototype !== Array.prototype

                * Extending the NodeList (anti-pattern)
                  * NodeList.prototype.forEach = Array.prototype.forEach;
                * Borrowing methods
                  * Array.prototype.forEach.call(nodes, function(node){ ... });
                  * Array.prototype.forEach.call(nodes, node => { ... });
                * Transform NodeList to Array
                  * nodes = Array.prototype.slice.call(nodes);

	            </script>
	        </section>
		</section>

		<!-- Mainpulating the DOM -->
		<section>
			 <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Manipulation
                    <img style="float:left" src="https://docs.google.com/drawings/d/1s7uE8zx4w2lGx1F_6yNItPKtirNkZalifNAcoKHS_Js/pub?w=711&h=577" />
                    How to move, insert, delete, copy nodes in the DOM



                </script>
			</section>

             <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Manipulation of the DOM
                    * Adding nodes
                      * node.appendChild(newNode)
                        * Adds or moves
                      * node.insertBefore(newNode, beforeNode)
                    * Replacing nodes
                      * node.replaceChild(newNode, oldNode)
                    * Removing nodes
                      * node.removeChild(oldNode)
                    * Making clones
                      * node.cloneNode(bool)
                        * true makes a deep copy

                </script>
            </section>

            <!-- Creating nodes -->
			<section data-markdown>
                <script type="text/template">
                    ## Creating nodes

                    * document.createElement - Create a new <span style="border: 3px solid yellow">ELEMENT_NODE</span>
                    * document.createTextNode - Create a new <span style="border: 3px solid blue">TEXT_NODE</span>

                    ```javascript
                    let newTag = document.createElement('p');
                    let newText = document.createTextNode('Cool text!');

                    newTag.appendChild(newText);

                    document.querySelector('#main').appendChild(newTag);

                    ```
                </script>
			</section>


            <!-- innerHTML -->
            <section data-markdown>
                <script type="text/template">
                    ## Shortcuts

                    * textContent
                      * Creates one new TEXT_NODE
                      * Removes all children from element

                    ```javascript
                        element.textContent = 'Text...';
                    ```

                    * innerHTML
                      * Parses the string
                      * Creates elements and text nodes
                      * Removes all children from element
                      * Less secure. Use textContent!

                    ```javascript
                        element.innerHTML = '<p>Some text</p>';
                    ```


                </script>
            </section>

             <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Attributes

                    * getAttribute('attribute name')
                    * setAttribute('attribute name', value)
                    * removeAttribute('attribute name')

                    ```javascript
                    let newTag = document.createElement('img');

                    newTag.setAttribute('src', 'image/picture.svg');

                    // The browser fetches and caches the 'picture.svg'

                    document.querySelector('#main').appendChild(newTag);

                    ```
                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Styles

                    ```javascript
                    let node = document.querySelector('#discovery');

                    node.style.color = '#AA5698';
                    ```

                    ```html
                    <p id="discovery" style="color: #AA5698">Hello</p>
                    ```


                    | CSS Property | Identifier |
                    | :----------- | :--------- |
                    | font-size    | fontSize   |
                    | margin-left  | marginLeft |
                    | ...          | ...        |
                    | float        | cssFloat   |

                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Styles

                    |         |            |   |
                    | :-------------: |:-------------:| :-----:|
                    | ![](../images/html64p.png) | .html | Structure |
                    | ![](../images/css64g.png) | .css      |    Presentation |
                    | ![](../images/js64y.png)    | .js | Behavior |

                    Avoid putting your css in the .js-file, use classes instead!

                    Exception: Properties that change dynamically
                    ```javascript
                    ...

                    movingElement.style.left = x + 'px';
                    movingElement.style.top = y + 'px';

                    ...
                    ```

                </script>
            </section>


            <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Use classes instead

                    <span class="lnu source">.js</span>
                    ```javascript
                    let node = document.querySelector('#discovery');

                    node.classList.add('jschanged');

                    ```
                    <span class="lnu source">.html</span>

                    ```html
                    <p id="discovery" class="whatever jschanged">Hello</p>
                    ```

                    <span class="lnu source">.css</span>
                    ```css
                    .jschanged {
                        color: #AA5698;
                    }
                    ```

                    * classList.add, classList.remove, classList.toggle, classList.contains

                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Write HTML in JS?

                    <span class="lnu source">.js</span>
                    ```javascript
                    let p = document.createElement('p');
                    p.classList.add('post');
                    let ul = document.createElement('ul');
                    let li1 = document.createElement('li');
                    let li2 = document.createElement('li');
                    li1.classList.add('active');
                    let a1 = document.createElement('a');
                    a1.setAttribute('href', '#');
                    let text1 = document.createTextNode('The first link');
                    a1.appendChild(text1);
                    let a2 = document.createElement('a');
                    a2.setAttribute('href', '#');
                    let text2 = document.createTextNode('The second link');
                    a2.appendChild(text2);
                    li1.appendChild(a1);
                    li2.appendChild(a2);
                    ul.appendChild(li1);
                    ul.appendChild(li2);
                    p.appendChild(ul);
                    document.querySelector('body').appendChild(p);

                    ```


                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                    ## Templates

                    <span class="lnu source">.html</span>
                    ```html
                    <template id="post-template">
                        <p class="post">
                            <ul>
                                <li class="active">
                                    <a href="#">The first link</a>
                                </li>
                                <li>
                                    <a href="#">The second link</a>
                                </li>
                            </ul>
                        </p>
                    </template>

                    ```

                    <span class="lnu source">.js</span>
                    ```javascript
                    let template = document.querySelector('#post-template');
                    let clone = document.importNode(template.content, true);
                    document.querySelector('body').appendChild(clone);
                    ```

                    Mustache, Underscore Templates, HandlebarsJS, Pug....
                </script>
            </section>

		</section>

        <!-- Event -->
        <section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Event

                ![](https://docs.google.com/drawings/d/1yNMiWNttvEAd5CApyUHqU-aNuXa8ij4qrlS8kLqicQo/pub?w=1307&h=699)
                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Event

                * User initialized
                  * Mouse, scrolling, keyboard ...
                * Browser initialized
                  * Page loaded, DOM Changed ...
                * Network
                  * Content loaded ...

                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Anti-pattern

                ```html
                <a href="page.html" onclick="doSomething();">The link</a>
                ```
                </script>
            </section>


            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Add event listeners

                "When *this* happens do *that*"

                ```javascript
                let a = document.querySelector('#theatag');

                a.addEventListener('click', buttonClicked);

                function buttonClicked(event){
                    console.log('You clicked the link!');
                };

                ```

                ```javascript
                let a = document.querySelector('#theatag');

                a.addEventListener('click', function(event){
                    console.log('You clicked the link!');
                });

                ```

                ```javascript
                let a = document.querySelector('#theatag');

                a.addEventListener('click', event => {
                    console.log('You clicked the link!');
                });

                ```

                </script>
            </section>


            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Remove event listeners

                using Named function expressions


                ```javascript
                let a = document.querySelector('#theatag');

                a.addEventListener('click', function buttonClicked(event){
                    console.log('You can only click me once!');

                    a.removeEventListener('click', buttonClicked);
                });

                ```


                </script>
            </section>

             <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Propagation

                <img style="float:left; padding-right: 30px" src="https://docs.google.com/drawings/d/1erJ1Umamf8NOlH3VPRNJVGucIzHcYIX6T8oqnUiyr1k/pub?w=428&h=611" />

                ```javascript
                let a = document.querySelector('#atag');
                let p = document.querySelector('#ptag');

                a.addEventListener('click', function(event){
                    console.log('You clicked the link!');

                    event.stopPropagation();
                });

                p.addEventListener('click', function(event){
                    console.log('Damn you a! I will not be called.');
                });

                ```

                ```javascript
                p.addEventListener('click', function(event){
                    console.log('Hihi! Captured it!');
                }, true);

                ```
                </script>
            </section>

            <!-- What triggered the event? -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## What triggered the event?

                Inside an event handler *this*<br>will reference the element <br>which triggered the event.
                ```javascript
                let a = document.querySelector('#atag');

                a.addEventListener('click', function(event){
                    a === this;             // true
                    a === event.target;     // true
                    this === event.target;  // true
                });
                ```
                </script>
            </section>

            <!-- Event and for-loop -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## What triggered the event?

                Closures can cause headache

                ```html
                <div id="links">
                    <a href="#">The first link</a>
                    <a href="#">The second link</a>
                    <a href="#">The third link</a>
                    <a href="#">The forth link</a>
                </div>
                ```

                ```javascript
                let aTags = document.querySelectorAll('#links a');

                for(let i = 0 ; i < aTags.length; i += 1){
                    aTags[i].addEventListener('click', function(event){
                        console.log('Clicked link ', i);  // 4
                        console.log(this.textContent);  // Correct
                        console.log(event.target.textContent); // Correct

                    });
                }
                ```

                <span class="lnu source">https://jsfiddle.net/Leitet/j0umya0d/</span>


                </script>
            </section>

            <!-- Event and forEach -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## What triggered the event?

                Functions ftw, or?

                ```html
                <div id="links">
                    <a href="#">The first link</a>
                    <a href="#">The second link</a>
                    <a href="#">The third link</a>
                    <a href="#">The forth link</a>
                </div>
                ```

                ```javascript
                let aTags = document.querySelectorAll('#links a');

                Array.prototype.forEach.call(aTags, function(a){
                    a.addEventListener('click', function(event){
                        console.log(a.textContent); // Correct
                        console.log(this.textContent); // Correct
                        console.log(event.target.textContent); // Correct
                    });
                });
                ```

                <span class="lnu source">https://jsfiddle.net/Leitet/j0umya0d/</span>


                </script>
            </section>

            <!-- Event delegation -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Event delegation
                Add one listener instead of four

                ```html
                <div id="links">
                    <a href="#">The first link</a>
                    <a href="#">The second link</a>
                    <a href="#">The third link</a>
                    <a href="#">The forth link</a>
                </div>
                ```

                ```javascript
                let div = document.querySelectorAll('#links');

                div.addEventListener('click', function(event){
                        console.log(this.textContent); // "The first link" "The second....
                        console.log(event.target.textContent); // "The first link"

                        this === div; //true
                        this === event.currentTarget; // true
                });
                ```

                <span class="lnu source">https://jsfiddle.net/Leitet/j0umya0d/</span>


                </script>
            </section>

            <!-- .bind() -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## .bind()

                ```javascript
                let Something = function(element) {
                    this.name = 'Something Good';

                    this.onclick1 = function(event) {
                        console.log(this.name); // undefined, as this is the element
                    };
                    this.onclick2 = function(event) {
                        console.log(this.name); // 'Something Good', as this is the binded Something object
                    };

                    element.addEventListener('click', this.onclick1, false);
                    element.addEventListener('click', this.onclick2.bind(this), false);
                }
                ```
                * Problem:
                  * You can not remove the event listener beacuse bind creates a new function

                <p class="lnu source">https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener</p>
                <p class="lnu source">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind<p>
                </script>
            </section>

            <!-- preventDefault -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Stop the default action

                ```javascript
                let a = document.querySelector('#atag');

                a.addEventListener('click', function(event){
                    console.log('I got this. Don´t activate the link!');
                    event.preventDefault();

                });
                ```

                Another alternative is to *return false* from the listener.
                </script>
            </section>

            <!-- preventDefault -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Timers
                Timeout:
                ```javascript
                let timer = setTimeout(function(){
                    console.log('At least 3 seconds passed..');

                }, 3000);
                ```

                ```javascript
                clearTimeout(timer); // Stops the timer
                ```
                *************
                Interval:
                ```javascript
                let timer = setInterval(function(){
                    console.log('At least 3 seconds passed..');
                }, 3000);
                ```

                ```javascript
                clearInterval(timer); // Stops the interval
                ```
                </script>
            </section>

            <!-- The event loop -->
            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## The Event loop

                <img style="float:left" src="https://docs.google.com/drawings/d/1e4BVPRteCsIQ4rg8ZcqO0prt7S3cC7kkxM65nsm4AYM/pub?w=383&h=755" />
                <br><br><br><br><br>
                ```javascript
                setTimeout(function(){
                    console.log('Sending a message to the event queue');
                }, 0);
                ```

                ```javascript
                let a = document.querySelectorAll('a')[0];

                a.addEventListener('click', function(){
                    console.log('Sending a message when user clicks link');
                });

                ```
                </script>
            </section>

            <section class="noborderimages" data-markdown>
                <script type="text/template">
                ## Next lecture

                * The event loop
                * Asynchronous vs. Synchronous
                * Blocking vs. nonblocking
                * AJAX (xmlhttprequest)
                * JSON

                </script>
            </section>

        </section>


        </div>
    </div>

    <script src="../reveal.js/lib/js/head.min.js"></script>
    <script src="../reveal.js/js/reveal.js"></script>

    <script>
        // Full list of configuration options available at:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            width: 1280,
            height: 800,
            controls: true,
            progress: true,
            history: true,
            center: false,

            transition: 'slide', // none/fade/slide/convex/concave/zoom

            // Optional reveal.js plugins
            dependencies: [
                { src: '../reveal.js/lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: '../reveal.js/plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: '../reveal.js/plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: '../reveal.js/plugin/highlight/highlight.js', async: true, condition: function () { return !!document.querySelector('pre code'); }, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: '../reveal.js/plugin/zoom-js/zoom.js', async: true },
                { src: '../reveal.js/plugin/notes/notes.js', async: true }
            ]
        });

    </script>

</body>
</html>
